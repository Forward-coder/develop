import{g as G,s as z,c as H}from"./reservation-ffa2f614.js";import{g as J}from"./roomType-45cf62ae.js";import{b as K,c as Q}from"./dict-a7885ece.js";import{_ as W,B as X,r,o as m,c as v,b as t,w as a,e as p,a as Y,i as c,F as D,C as N,t as Z,n as b,G as ee,f as O,E as R,D as le}from"./index-362cbba5.js";import"./request-f1d2817d.js";const te={class:"page"},ae={class:"toolbar"},oe={__name:"ReservationList",setup(ne){const x=p([]),U=p([]),C=p([]),y=p([]),d=O({reservationNo:"",guestName:"",statusId:null,checkInDate:""}),f=p(!1),V=p(null),h=p(!1),o=O({roomTypeId:null,channelId:1,statusId:1,checkInDate:"",checkOutDate:"",guestName:"",guestPhone:"",guestIdNo:"",roomRate:null,remark:""}),T={roomTypeId:[{required:!0,message:"请选择房型",trigger:"change"}],checkInDate:[{required:!0,message:"请选择入住日期",trigger:"change"},{validator:(s,e,n)=>{e?o.checkOutDate&&e>=o.checkOutDate?n(new Error("入住日期必须早于退房日期")):n():n(new Error("请选择入住日期"))},trigger:"change"}],checkOutDate:[{required:!0,message:"请选择退房日期",trigger:"change"},{validator:(s,e,n)=>{e?o.checkInDate&&e<=o.checkInDate?n(new Error("退房日期必须晚于入住日期")):n():n(new Error("请选择退房日期"))},trigger:"change"}],guestName:[{required:!0,message:"请输入客人姓名",trigger:"blur"},{min:2,max:20,message:"姓名长度应在 2 到 20 个字符之间",trigger:"blur"}],guestPhone:[{required:!1,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],roomRate:[{required:!0,message:"请输入房价",trigger:"blur"},{type:"number",min:.01,message:"房价必须大于0",trigger:"blur"}]};async function _(){const s=await G(d);x.value=s.list||[]}async function E(){const[s,e,n]=await Promise.all([K(),Q(),J()]);U.value=s||[],C.value=e||[],y.value=(n==null?void 0:n.list)||n||[]}function M(){L(),f.value=!0}function L(){var s,e;Object.assign(o,{roomTypeId:null,channelId:1,statusId:1,checkInDate:"",checkOutDate:"",guestName:"",guestPhone:"",guestIdNo:"",roomRate:((s=y.value[0])==null?void 0:s.basePrice)??298,remark:""}),(e=V.value)==null||e.resetFields()}async function P(){var s;try{await((s=V.value)==null?void 0:s.validate()),h.value=!0,await z(o),R.success("预订成功"),f.value=!1,_()}catch(e){e instanceof Error?console.log("表单校验未通过:",e.message):R.error((e==null?void 0:e.message)||"提交失败")}finally{h.value=!1}}async function q(s){await le.confirm("确定取消该预订吗？","提示",{type:"warning"}),await H(s.id),R.success("已取消"),_()}return X(async()=>{await E(),await _()}),(s,e)=>{const n=r("el-button"),g=r("el-input"),k=r("el-option"),I=r("el-select"),w=r("el-date-picker"),u=r("el-table-column"),F=r("el-tag"),B=r("el-table"),$=r("el-card"),i=r("el-form-item"),S=r("el-input-number"),j=r("el-form"),A=r("el-dialog");return m(),v("div",te,[t($,null,{header:a(()=>[e[16]||(e[16]=Y("span",null,"预订管理",-1)),t(n,{type:"primary",style:{float:"right"},onClick:M},{default:a(()=>[...e[15]||(e[15]=[c("新建预订",-1)])]),_:1})]),default:a(()=>[Y("div",ae,[t(g,{modelValue:d.reservationNo,"onUpdate:modelValue":e[0]||(e[0]=l=>d.reservationNo=l),placeholder:"预订单号",clearable:"",style:{width:"180px"}},null,8,["modelValue"]),t(g,{modelValue:d.guestName,"onUpdate:modelValue":e[1]||(e[1]=l=>d.guestName=l),placeholder:"客人姓名",clearable:"",style:{width:"120px"}},null,8,["modelValue"]),t(I,{modelValue:d.statusId,"onUpdate:modelValue":e[2]||(e[2]=l=>d.statusId=l),placeholder:"预订状态",clearable:"",style:{width:"120px"}},{default:a(()=>[(m(!0),v(D,null,N(U.value,l=>(m(),b(k,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(w,{modelValue:d.checkInDate,"onUpdate:modelValue":e[3]||(e[3]=l=>d.checkInDate=l),type:"date",placeholder:"入住日期","value-format":"YYYY-MM-DD",style:{width:"140px"}},null,8,["modelValue"]),t(n,{type:"primary",onClick:_},{default:a(()=>[...e[17]||(e[17]=[c("查询",-1)])]),_:1})]),t(B,{data:x.value,border:"",stripe:""},{default:a(()=>[t(u,{prop:"reservationNo",label:"预订单号",width:"160"}),t(u,{prop:"roomTypeName",label:"房型",width:"90"}),t(u,{prop:"roomNo",label:"房号",width:"70"}),t(u,{prop:"channelName",label:"渠道",width:"80"}),t(u,{prop:"statusName",label:"状态",width:"90"},{default:a(({row:l})=>[t(F,{type:l.statusId===3?"info":l.statusId===1?"warning":"success"},{default:a(()=>[c(Z(l.statusName),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"checkInDate",label:"入住日期",width:"110"}),t(u,{prop:"checkOutDate",label:"退房日期",width:"110"}),t(u,{prop:"guestName",label:"客人",width:"90"}),t(u,{prop:"guestPhone",label:"电话",width:"120"}),t(u,{prop:"roomRate",label:"房价",width:"80"}),t(u,{label:"操作",width:"100",fixed:"right"},{default:a(({row:l})=>[l.statusId===1?(m(),b(n,{key:0,link:"",type:"danger",onClick:se=>q(l)},{default:a(()=>[...e[18]||(e[18]=[c("取消",-1)])]),_:1},8,["onClick"])):ee("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),t(A,{modelValue:f.value,"onUpdate:modelValue":e[14]||(e[14]=l=>f.value=l),title:"新建预订",width:"520px",onClose:L},{footer:a(()=>[t(n,{onClick:e[13]||(e[13]=l=>f.value=!1)},{default:a(()=>[...e[19]||(e[19]=[c("取消",-1)])]),_:1}),t(n,{type:"primary",loading:h.value,onClick:P},{default:a(()=>[...e[20]||(e[20]=[c("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(j,{ref_key:"resFormRef",ref:V,model:o,rules:T,"label-width":"100px"},{default:a(()=>[t(i,{label:"房型",prop:"roomTypeId"},{default:a(()=>[t(I,{modelValue:o.roomTypeId,"onUpdate:modelValue":e[4]||(e[4]=l=>o.roomTypeId=l),placeholder:"请选择",style:{width:"100%"}},{default:a(()=>[(m(!0),v(D,null,N(y.value,l=>(m(),b(k,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"渠道",prop:"channelId"},{default:a(()=>[t(I,{modelValue:o.channelId,"onUpdate:modelValue":e[5]||(e[5]=l=>o.channelId=l),placeholder:"请选择",style:{width:"100%"}},{default:a(()=>[(m(!0),v(D,null,N(C.value,l=>(m(),b(k,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"入住日期",prop:"checkInDate"},{default:a(()=>[t(w,{modelValue:o.checkInDate,"onUpdate:modelValue":e[6]||(e[6]=l=>o.checkInDate=l),type:"date","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(i,{label:"退房日期",prop:"checkOutDate"},{default:a(()=>[t(w,{modelValue:o.checkOutDate,"onUpdate:modelValue":e[7]||(e[7]=l=>o.checkOutDate=l),type:"date","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(i,{label:"客人姓名",prop:"guestName"},{default:a(()=>[t(g,{modelValue:o.guestName,"onUpdate:modelValue":e[8]||(e[8]=l=>o.guestName=l),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),t(i,{label:"客人电话",prop:"guestPhone"},{default:a(()=>[t(g,{modelValue:o.guestPhone,"onUpdate:modelValue":e[9]||(e[9]=l=>o.guestPhone=l),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),t(i,{label:"证件号",prop:"guestIdNo"},{default:a(()=>[t(g,{modelValue:o.guestIdNo,"onUpdate:modelValue":e[10]||(e[10]=l=>o.guestIdNo=l),placeholder:"选填"},null,8,["modelValue"])]),_:1}),t(i,{label:"房价",prop:"roomRate"},{default:a(()=>[t(S,{modelValue:o.roomRate,"onUpdate:modelValue":e[11]||(e[11]=l=>o.roomRate=l),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(i,{label:"备注",prop:"remark"},{default:a(()=>[t(g,{modelValue:o.remark,"onUpdate:modelValue":e[12]||(e[12]=l=>o.remark=l),type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},pe=W(oe,[["__scopeId","data-v-567d7610"]]);export{pe as default};
