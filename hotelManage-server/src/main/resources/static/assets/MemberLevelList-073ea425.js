import{a as q,b as N,t as S}from"./member-c9d798c3.js";import{_ as j,B as D,r as s,o as O,c as z,b as t,w as n,e as f,f as I,E as m,a as x,i,t as g,D as T}from"./index-fddec7dd.js";import"./request-7f0efd49.js";const A={class:"page"},G={__name:"MemberLevelList",setup(H){const v=f([]),d=f(!1),c=f(null),b=f(!1),o=I({id:null,name:"",discountRate:1,minPoints:0,isEnabled:!0}),k={name:[{required:!0,message:"请输入等级名称",trigger:"blur"}],discountRate:[{required:!0,message:"请输入折扣率",trigger:"blur"}],minPoints:[{required:!0,message:"请输入最低积分",trigger:"blur"}]};async function _(){var l;try{const e=await q();v.value=((l=e==null?void 0:e.data)==null?void 0:l.data)||(e==null?void 0:e.data)||e||[]}catch(e){console.error("加载会员等级列表失败:",e),m.error("加载数据失败")}}function y(l){l?Object.assign(o,{id:l.id,name:l.name,discountRate:l.discountRate,minPoints:l.minPoints,isEnabled:l.isEnabled}):E(),d.value=!0}function E(){var l;Object.assign(o,{id:null,name:"",discountRate:1,minPoints:0,isEnabled:!0}),(l=c.value)==null||l.resetFields()}async function L(){var l;await((l=c.value)==null?void 0:l.validate().catch(()=>{})),b.value=!0;try{await N({...o}),m.success("保存成功"),d.value=!1,_()}catch(e){m.error((e==null?void 0:e.message)||"保存失败")}finally{b.value=!1}}async function R(l){try{await T.confirm(`确定要${l.isEnabled?"禁用":"启用"}该会员等级吗？`,"提示",{type:"warning"}),await S(l.id,!l.isEnabled),m.success(`${l.isEnabled?"禁用":"启用"}成功`),_()}catch(e){e!=="cancel"&&m.error((e==null?void 0:e.message)||"操作失败")}}return D(()=>{_()}),(l,e)=>{const u=s("el-button"),r=s("el-table-column"),C=s("el-tag"),M=s("el-table"),P=s("el-card"),w=s("el-input"),p=s("el-form-item"),V=s("el-input-number"),$=s("el-switch"),B=s("el-form"),U=s("el-dialog");return O(),z("div",A,[t(P,null,{header:n(()=>[e[8]||(e[8]=x("span",null,"会员等级管理",-1)),t(u,{type:"primary",style:{float:"right"},onClick:e[0]||(e[0]=a=>y())},{default:n(()=>[...e[7]||(e[7]=[i("新增等级",-1)])]),_:1})]),default:n(()=>[t(M,{data:v.value,border:"",stripe:""},{default:n(()=>[t(r,{prop:"name",label:"等级名称",width:"120"}),t(r,{prop:"discountRate",label:"折扣率",width:"100"},{default:n(({row:a})=>[i(g((a.discountRate*100).toFixed(0))+"% ",1)]),_:1}),t(r,{prop:"minPoints",label:"最低积分",width:"120"}),t(r,{prop:"isEnabled",label:"状态",width:"100"},{default:n(({row:a})=>[t(C,{type:a.isEnabled?"success":"danger"},{default:n(()=>[i(g(a.isEnabled?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(r,{label:"操作",width:"140",fixed:"right"},{default:n(({row:a})=>[t(u,{link:"",type:"primary",onClick:F=>y(a)},{default:n(()=>[...e[9]||(e[9]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(u,{link:"",type:a.isEnabled?"danger":"success",onClick:F=>R(a)},{default:n(()=>[i(g(a.isEnabled?"禁用":"启用"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),t(U,{modelValue:d.value,"onUpdate:modelValue":e[6]||(e[6]=a=>d.value=a),title:o.id?"编辑会员等级":"新增会员等级",width:"450px",onClose:E},{footer:n(()=>[t(u,{onClick:e[5]||(e[5]=a=>d.value=!1)},{default:n(()=>[...e[11]||(e[11]=[i("取消",-1)])]),_:1}),t(u,{type:"primary",loading:b.value,onClick:L},{default:n(()=>[...e[12]||(e[12]=[i("确定",-1)])]),_:1},8,["loading"])]),default:n(()=>[t(B,{ref_key:"formRef",ref:c,model:o,rules:k,"label-width":"90px"},{default:n(()=>[t(p,{label:"等级名称",prop:"name"},{default:n(()=>[t(w,{modelValue:o.name,"onUpdate:modelValue":e[1]||(e[1]=a=>o.name=a),placeholder:"请输入等级名称"},null,8,["modelValue"])]),_:1}),t(p,{label:"折扣率",prop:"discountRate"},{default:n(()=>[t(V,{modelValue:o.discountRate,"onUpdate:modelValue":e[2]||(e[2]=a=>o.discountRate=a),min:.1,max:1,step:.05,precision:2,style:{width:"100%"}},null,8,["modelValue"]),e[10]||(e[10]=x("div",{style:{"font-size":"12px",color:"#999","margin-top":"5px"}}," 例如：0.95 表示 95折 ",-1))]),_:1}),t(p,{label:"最低积分",prop:"minPoints"},{default:n(()=>[t(V,{modelValue:o.minPoints,"onUpdate:modelValue":e[3]||(e[3]=a=>o.minPoints=a),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(p,{label:"状态",prop:"isEnabled"},{default:n(()=>[t($,{modelValue:o.isEnabled,"onUpdate:modelValue":e[4]||(e[4]=a=>o.isEnabled=a),"active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},W=j(G,[["__scopeId","data-v-0fa80eb9"]]);export{W as default};
