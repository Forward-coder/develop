import{r as v}from"./request-7f0efd49.js";import{g as A}from"./role-22a8df34.js";import{_ as G,B as H,r,o as k,c as I,b as l,w as a,e as y,f as w,a as L,i,t as J,F as K,C as P,E,D as Q,n as W}from"./index-fddec7dd.js";function X(d={}){return v({url:"/api/sys/user/list",method:"get",params:d}).then(m=>({list:m||[],total:(m||[]).length}))}function Y(d){return d.id?v({url:`/api/sys/user/${d.id}`,method:"put",data:d}):v({url:"/api/sys/user/save",method:"post",data:d})}function Z(d){return v({url:`/api/sys/user/${d}`,method:"delete"})}const ee={class:"page"},le={class:"toolbar"},te={__name:"SystemUserList",setup(d){const m=y([]),c=y([]),p=w({username:"",realName:""}),f=y(!1),V=y(null),N=y(!1),s=w({id:null,username:"",realName:"",phone:"",roleIds:[],roleNames:"",isEnabled:1}),S={username:[{required:!0,message:"请输入登录名",trigger:"blur"}],roleIds:[{required:!0,message:"请至少选择一个角色",trigger:"change",type:"array",min:1}]};async function g(){const o=await X(p);m.value=o.list||[]}async function B(){const o=await A();c.value=o.list||[]}function U(o){if(o){if(Object.assign(s,{id:o.id,username:o.username,realName:o.realName,phone:o.phone||"",roleIds:o.roleIds||(o.roleNames?[]:[]),roleNames:o.roleNames,isEnabled:o.isEnabled??1}),!s.roleIds.length&&o.roleNames){const e=o.roleNames.split(/[,，]/);s.roleIds=c.value.filter(n=>e.includes(n.name)).map(n=>n.id)}}else x();f.value=!0}function x(){var o;Object.assign(s,{id:null,username:"",realName:"",phone:"",roleIds:[],roleNames:"",isEnabled:1}),(o=V.value)==null||o.resetFields()}async function $(){var e;await((e=V.value)==null?void 0:e.validate().catch(()=>{}));const o=c.value.filter(n=>s.roleIds.includes(n.id)).map(n=>n.name).join(",");N.value=!0;try{await Y({...s,roleNames:o}),E.success("保存成功"),f.value=!1,g()}catch(n){E.error((n==null?void 0:n.message)||"保存失败")}finally{N.value=!1}}async function h(o){await Q.confirm("确定删除该用户吗？","提示",{type:"warning"}),await Z(o.id),E.success("删除成功"),g()}return H(async()=>{await B(),await g()}),(o,e)=>{const n=r("el-button"),_=r("el-input"),u=r("el-table-column"),F=r("el-tag"),q=r("el-table"),R=r("el-card"),b=r("el-form-item"),j=r("el-option"),D=r("el-select"),C=r("el-radio"),M=r("el-radio-group"),O=r("el-form"),T=r("el-dialog");return k(),I("div",ee,[l(R,null,{header:a(()=>[e[11]||(e[11]=L("span",null,"系统用户",-1)),l(n,{type:"primary",style:{float:"right"},onClick:e[0]||(e[0]=t=>U())},{default:a(()=>[...e[10]||(e[10]=[i("新增用户",-1)])]),_:1})]),default:a(()=>[L("div",le,[l(_,{modelValue:p.username,"onUpdate:modelValue":e[1]||(e[1]=t=>p.username=t),placeholder:"登录名",clearable:"",style:{width:"140px"}},null,8,["modelValue"]),l(_,{modelValue:p.realName,"onUpdate:modelValue":e[2]||(e[2]=t=>p.realName=t),placeholder:"姓名",clearable:"",style:{width:"140px"}},null,8,["modelValue"]),l(n,{type:"primary",onClick:g},{default:a(()=>[...e[12]||(e[12]=[i("查询",-1)])]),_:1})]),l(q,{data:m.value,border:"",stripe:""},{default:a(()=>[l(u,{prop:"username",label:"登录名",width:"120"}),l(u,{prop:"realName",label:"姓名",width:"120"}),l(u,{prop:"phone",label:"手机号",width:"130"}),l(u,{prop:"roleNames",label:"角色",width:"140"}),l(u,{prop:"isEnabled",label:"状态",width:"90"},{default:a(({row:t})=>[l(F,{type:t.isEnabled===1?"success":"info"},{default:a(()=>[i(J(t.isEnabled===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(u,{label:"操作",width:"140",fixed:"right"},{default:a(({row:t})=>[l(n,{link:"",type:"primary",onClick:z=>U(t)},{default:a(()=>[...e[13]||(e[13]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(n,{link:"",type:"danger",onClick:z=>h(t)},{default:a(()=>[...e[14]||(e[14]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),l(T,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=t=>f.value=t),title:s.id?"编辑用户":"新增用户",width:"480px",onClose:x},{footer:a(()=>[l(n,{onClick:e[8]||(e[8]=t=>f.value=!1)},{default:a(()=>[...e[17]||(e[17]=[i("取消",-1)])]),_:1}),l(n,{type:"primary",loading:N.value,onClick:$},{default:a(()=>[...e[18]||(e[18]=[i("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(O,{ref_key:"formRef",ref:V,model:s,rules:S,"label-width":"90px"},{default:a(()=>[l(b,{label:"登录名",prop:"username"},{default:a(()=>[l(_,{modelValue:s.username,"onUpdate:modelValue":e[3]||(e[3]=t=>s.username=t),placeholder:"用于登录",disabled:!!s.id},null,8,["modelValue","disabled"])]),_:1}),l(b,{label:"姓名",prop:"realName"},{default:a(()=>[l(_,{modelValue:s.realName,"onUpdate:modelValue":e[4]||(e[4]=t=>s.realName=t),placeholder:"真实姓名"},null,8,["modelValue"])]),_:1}),l(b,{label:"手机号",prop:"phone"},{default:a(()=>[l(_,{modelValue:s.phone,"onUpdate:modelValue":e[5]||(e[5]=t=>s.phone=t),placeholder:"选填"},null,8,["modelValue"])]),_:1}),l(b,{label:"角色",prop:"roleIds"},{default:a(()=>[l(D,{modelValue:s.roleIds,"onUpdate:modelValue":e[6]||(e[6]=t=>s.roleIds=t),multiple:"",placeholder:"请选择角色",style:{width:"100%"}},{default:a(()=>[(k(!0),I(K,null,P(c.value,t=>(k(),W(j,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"状态",prop:"isEnabled"},{default:a(()=>[l(M,{modelValue:s.isEnabled,"onUpdate:modelValue":e[7]||(e[7]=t=>s.isEnabled=t)},{default:a(()=>[l(C,{label:1},{default:a(()=>[...e[15]||(e[15]=[i("启用",-1)])]),_:1}),l(C,{label:0},{default:a(()=>[...e[16]||(e[16]=[i("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ne=G(te,[["__scopeId","data-v-e8af6e85"]]);export{ne as default};
