import{g as z}from"./role-a9c72bb7.js";import{_ as A,B as G,r as d,o as E,c as w,b as l,w as t,e as g,f as C,a as L,i as m,t as H,F as J,C as K,E as k,D as Q,n as W}from"./index-31da5b45.js";let p=[{id:1,username:"admin",realName:"系统管理员",phone:"",roleIds:[1],roleNames:"管理员",isEnabled:1},{id:2,username:"reception1",realName:"前台小李",phone:"13700001111",roleIds:[2],roleNames:"前台",isEnabled:1}],X=3;function Y(i={}){let n=[...p];return i.username&&(n=n.filter(u=>u.username.includes(i.username))),i.realName&&(n=n.filter(u=>(u.realName||"").includes(i.realName))),Promise.resolve({list:n,total:n.length})}function Z(i){if(i.id){const n=p.findIndex(u=>u.id===i.id);if(n>=0)return p[n]={...p[n],...i},Promise.resolve(p[n])}else{const n={id:X++,...i,isEnabled:i.isEnabled??1};return p.push(n),Promise.resolve(n)}return Promise.reject(new Error("保存失败"))}function ee(i){return p=p.filter(n=>n.id!==Number(i)),Promise.resolve()}const le={class:"page"},ae={class:"toolbar"},te={__name:"SystemUserList",setup(i){const n=g([]),u=g([]),_=C({username:"",realName:""}),b=g(!1),N=g(null),V=g(!1),s=C({id:null,username:"",realName:"",phone:"",roleIds:[],roleNames:"",isEnabled:1}),S={username:[{required:!0,message:"请输入登录名",trigger:"blur"}],roleIds:[{required:!0,message:"请至少选择一个角色",trigger:"change",type:"array",min:1}]};async function v(){const o=await Y(_);n.value=o.list||[]}async function B(){const o=await z();u.value=o.list||[]}function I(o){if(o){if(Object.assign(s,{id:o.id,username:o.username,realName:o.realName,phone:o.phone||"",roleIds:o.roleIds||(o.roleNames?[]:[]),roleNames:o.roleNames,isEnabled:o.isEnabled??1}),!s.roleIds.length&&o.roleNames){const e=o.roleNames.split(/[,，]/);s.roleIds=u.value.filter(r=>e.includes(r.name)).map(r=>r.id)}}else x();b.value=!0}function x(){var o;Object.assign(s,{id:null,username:"",realName:"",phone:"",roleIds:[],roleNames:"",isEnabled:1}),(o=N.value)==null||o.resetFields()}async function F(){var e;await((e=N.value)==null?void 0:e.validate().catch(()=>{}));const o=u.value.filter(r=>s.roleIds.includes(r.id)).map(r=>r.name).join(",");V.value=!0;try{await Z({...s,roleNames:o}),k.success("保存成功"),b.value=!1,v()}catch(r){k.error((r==null?void 0:r.message)||"保存失败")}finally{V.value=!1}}async function P(o){await Q.confirm("确定删除该用户吗？","提示",{type:"warning"}),await ee(o.id),k.success("删除成功"),v()}return G(async()=>{await B(),await v()}),(o,e)=>{const r=d("el-button"),c=d("el-input"),f=d("el-table-column"),R=d("el-tag"),j=d("el-table"),q=d("el-card"),y=d("el-form-item"),$=d("el-option"),h=d("el-select"),U=d("el-radio"),D=d("el-radio-group"),M=d("el-form"),O=d("el-dialog");return E(),w("div",le,[l(q,null,{header:t(()=>[e[11]||(e[11]=L("span",null,"系统用户",-1)),l(r,{type:"primary",style:{float:"right"},onClick:e[0]||(e[0]=a=>I())},{default:t(()=>[...e[10]||(e[10]=[m("新增用户",-1)])]),_:1})]),default:t(()=>[L("div",ae,[l(c,{modelValue:_.username,"onUpdate:modelValue":e[1]||(e[1]=a=>_.username=a),placeholder:"登录名",clearable:"",style:{width:"140px"}},null,8,["modelValue"]),l(c,{modelValue:_.realName,"onUpdate:modelValue":e[2]||(e[2]=a=>_.realName=a),placeholder:"姓名",clearable:"",style:{width:"140px"}},null,8,["modelValue"]),l(r,{type:"primary",onClick:v},{default:t(()=>[...e[12]||(e[12]=[m("查询",-1)])]),_:1})]),l(j,{data:n.value,border:"",stripe:""},{default:t(()=>[l(f,{prop:"username",label:"登录名",width:"120"}),l(f,{prop:"realName",label:"姓名",width:"120"}),l(f,{prop:"phone",label:"手机号",width:"130"}),l(f,{prop:"roleNames",label:"角色",width:"140"}),l(f,{prop:"isEnabled",label:"状态",width:"90"},{default:t(({row:a})=>[l(R,{type:a.isEnabled===1?"success":"info"},{default:t(()=>[m(H(a.isEnabled===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(f,{label:"操作",width:"140",fixed:"right"},{default:t(({row:a})=>[l(r,{link:"",type:"primary",onClick:T=>I(a)},{default:t(()=>[...e[13]||(e[13]=[m("编辑",-1)])]),_:1},8,["onClick"]),l(r,{link:"",type:"danger",onClick:T=>P(a)},{default:t(()=>[...e[14]||(e[14]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),l(O,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=a=>b.value=a),title:s.id?"编辑用户":"新增用户",width:"480px",onClose:x},{footer:t(()=>[l(r,{onClick:e[8]||(e[8]=a=>b.value=!1)},{default:t(()=>[...e[17]||(e[17]=[m("取消",-1)])]),_:1}),l(r,{type:"primary",loading:V.value,onClick:F},{default:t(()=>[...e[18]||(e[18]=[m("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(M,{ref_key:"formRef",ref:N,model:s,rules:S,"label-width":"90px"},{default:t(()=>[l(y,{label:"登录名",prop:"username"},{default:t(()=>[l(c,{modelValue:s.username,"onUpdate:modelValue":e[3]||(e[3]=a=>s.username=a),placeholder:"用于登录",disabled:!!s.id},null,8,["modelValue","disabled"])]),_:1}),l(y,{label:"姓名",prop:"realName"},{default:t(()=>[l(c,{modelValue:s.realName,"onUpdate:modelValue":e[4]||(e[4]=a=>s.realName=a),placeholder:"真实姓名"},null,8,["modelValue"])]),_:1}),l(y,{label:"手机号",prop:"phone"},{default:t(()=>[l(c,{modelValue:s.phone,"onUpdate:modelValue":e[5]||(e[5]=a=>s.phone=a),placeholder:"选填"},null,8,["modelValue"])]),_:1}),l(y,{label:"角色",prop:"roleIds"},{default:t(()=>[l(h,{modelValue:s.roleIds,"onUpdate:modelValue":e[6]||(e[6]=a=>s.roleIds=a),multiple:"",placeholder:"请选择角色",style:{width:"100%"}},{default:t(()=>[(E(!0),w(J,null,K(u.value,a=>(E(),W($,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(y,{label:"状态",prop:"isEnabled"},{default:t(()=>[l(D,{modelValue:s.isEnabled,"onUpdate:modelValue":e[7]||(e[7]=a=>s.isEnabled=a)},{default:t(()=>[l(U,{label:1},{default:t(()=>[...e[15]||(e[15]=[m("启用",-1)])]),_:1}),l(U,{label:0},{default:t(()=>[...e[16]||(e[16]=[m("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},se=A(te,[["__scopeId","data-v-e8af6e85"]]);export{se as default};
