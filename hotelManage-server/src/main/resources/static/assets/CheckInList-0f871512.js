import{_ as H,u as J,B as K,r,o as I,c as L,b as o,w as t,e as i,a as N,i as m,F as Q,C as W,t as h,f as P,E as b,n as X}from"./index-362cbba5.js";import{g as Z,d as ee,e as oe}from"./checkIn-026114fb.js";import{g as le}from"./room-26e1a6ea.js";import"./request-f1d2817d.js";const te={class:"page"},ae={class:"toolbar"},ne={style:{color:"var(--el-text-color-secondary)","margin-left":"8px"}},ue={__name:"CheckInList",setup(re){const Y=J(),k=i([]),v=i([]),p=P({roomNo:"",guestName:""}),g=i(!1),c=i(!1),V=i(null),y=i(""),C=i(null),w=i(!1),a=P({roomId:null,roomNo:"",roomTypeId:null,roomTypeName:"",plannedCheckOutDate:"",roomRate:298,guestName:"",guestPhone:"",guestIdNo:"",depositTotal:0,remark:""}),q={roomId:[{required:!0,message:"请选择房间",trigger:"change"}],plannedCheckOutDate:[{required:!0,message:"请选择预计退房日期",trigger:"change"}],roomRate:[{required:!0,message:"请输入房费",trigger:"blur"}],guestName:[{required:!0,message:"请输入客人姓名",trigger:"blur"}]};async function _(){var n;try{const e={status:"staying"};p.roomNo&&(e.roomNo=p.roomNo),p.guestName&&(e.guestName=p.guestName);const u=await Z(e);k.value=((n=u.data)==null?void 0:n.data)||[]}catch(e){console.error("加载入住列表失败:",e),k.value=[]}}async function x(){var n,e;try{const u=await le({roomStatusId:1});v.value=((n=u.data)==null?void 0:n.data)||((e=u.data)==null?void 0:e.list)||[]}catch(u){console.error("加载可用房间失败:",u),v.value=[]}}function M(){x(),T(),g.value=!0}function T(){var n;Object.assign(a,{roomId:null,roomNo:"",roomTypeId:null,roomTypeName:"",plannedCheckOutDate:"",roomRate:298,guestName:"",guestPhone:"",guestIdNo:"",depositTotal:0,remark:""}),(n=C.value)==null||n.resetFields()}async function $(){var e;await((e=C.value)==null?void 0:e.validate().catch(()=>{}));const n=v.value.find(u=>u.id===a.roomId);if(n){w.value=!0;try{await ee({roomId:a.roomId,roomNo:n.roomNo,roomTypeId:n.roomTypeId,roomTypeName:n.roomTypeName,plannedCheckOutDate:a.plannedCheckOutDate,roomRate:a.roomRate,guestName:a.guestName,guestPhone:a.guestPhone,guestIdNo:a.guestIdNo,depositTotal:a.depositTotal,remark:a.remark}),b.success("入住成功"),g.value=!1,_(),x()}catch(u){b.error((u==null?void 0:u.message)||"办理失败")}finally{w.value=!1}}}function B(n){V.value=n,y.value=n.plannedCheckOutDate,c.value=!0}async function E(){if(!y.value){b.warning("请选择新退房日期");return}try{await oe(V.value.id,y.value),b.success("续住成功"),c.value=!1,_()}catch(n){b.error((n==null?void 0:n.message)||"续住失败")}}function F(n){Y.push({path:"/check-out",query:{id:n.id}})}return K(()=>{_()}),(n,e)=>{const u=r("el-button"),f=r("el-input"),d=r("el-table-column"),S=r("el-table"),j=r("el-card"),A=r("el-option"),z=r("el-select"),s=r("el-form-item"),D=r("el-date-picker"),R=r("el-input-number"),U=r("el-form"),O=r("el-dialog");return I(),L("div",te,[o(j,null,{header:t(()=>[e[16]||(e[16]=N("span",null,"入住管理",-1)),o(u,{type:"primary",style:{float:"right"},onClick:M},{default:t(()=>[...e[15]||(e[15]=[m("办理入住",-1)])]),_:1})]),default:t(()=>[N("div",ae,[o(f,{modelValue:p.roomNo,"onUpdate:modelValue":e[0]||(e[0]=l=>p.roomNo=l),placeholder:"房号",clearable:"",style:{width:"120px"}},null,8,["modelValue"]),o(f,{modelValue:p.guestName,"onUpdate:modelValue":e[1]||(e[1]=l=>p.guestName=l),placeholder:"客人姓名",clearable:"",style:{width:"120px"}},null,8,["modelValue"]),o(u,{type:"primary",onClick:_},{default:t(()=>[...e[17]||(e[17]=[m("查询",-1)])]),_:1})]),o(S,{data:k.value,border:"",stripe:""},{default:t(()=>[o(d,{prop:"checkInNo",label:"入住单号",width:"160"}),o(d,{prop:"roomNo",label:"房号",width:"80"}),o(d,{prop:"roomTypeName",label:"房型",width:"90"}),o(d,{prop:"guestName",label:"客人",width:"90"}),o(d,{prop:"guestPhone",label:"电话",width:"120"}),o(d,{prop:"actualCheckInTime",label:"入住时间",width:"160"}),o(d,{prop:"plannedCheckOutDate",label:"预计退房",width:"110"}),o(d,{prop:"roomRate",label:"房价",width:"80"}),o(d,{prop:"depositTotal",label:"押金",width:"80"}),o(d,{prop:"consumptionTotal",label:"消费",width:"80"}),o(d,{label:"操作",width:"120",fixed:"right"},{default:t(({row:l})=>[o(u,{link:"",type:"primary",onClick:G=>B(l)},{default:t(()=>[...e[18]||(e[18]=[m("续住",-1)])]),_:1},8,["onClick"]),o(u,{link:"",type:"primary",onClick:G=>F(l)},{default:t(()=>[...e[19]||(e[19]=[m("退房",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),o(O,{modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=l=>g.value=l),title:"办理入住",width:"560px",onClose:T},{footer:t(()=>[o(u,{onClick:e[10]||(e[10]=l=>g.value=!1)},{default:t(()=>[...e[20]||(e[20]=[m("取消",-1)])]),_:1}),o(u,{type:"primary",loading:w.value,onClick:$},{default:t(()=>[...e[21]||(e[21]=[m("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[o(U,{ref_key:"formRef",ref:C,model:a,rules:q,"label-width":"100px"},{default:t(()=>[o(s,{label:"房间",prop:"roomId"},{default:t(()=>[o(z,{modelValue:a.roomId,"onUpdate:modelValue":e[2]||(e[2]=l=>a.roomId=l),placeholder:"请选择房间",style:{width:"100%"},filterable:""},{default:t(()=>[(I(!0),L(Q,null,W(v.value,l=>(I(),X(A,{key:l.id,label:`${l.roomNo} (${l.roomTypeName})`,value:l.id},{default:t(()=>[N("span",null,h(l.roomNo),1),N("span",ne,h(l.roomTypeName),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(s,{label:"预计退房",prop:"plannedCheckOutDate"},{default:t(()=>[o(D,{modelValue:a.plannedCheckOutDate,"onUpdate:modelValue":e[3]||(e[3]=l=>a.plannedCheckOutDate=l),type:"date","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(s,{label:"房费(元/间夜)",prop:"roomRate"},{default:t(()=>[o(R,{modelValue:a.roomRate,"onUpdate:modelValue":e[4]||(e[4]=l=>a.roomRate=l),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(s,{label:"客人姓名",prop:"guestName"},{default:t(()=>[o(f,{modelValue:a.guestName,"onUpdate:modelValue":e[5]||(e[5]=l=>a.guestName=l),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(s,{label:"客人电话",prop:"guestPhone"},{default:t(()=>[o(f,{modelValue:a.guestPhone,"onUpdate:modelValue":e[6]||(e[6]=l=>a.guestPhone=l),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(s,{label:"证件号",prop:"guestIdNo"},{default:t(()=>[o(f,{modelValue:a.guestIdNo,"onUpdate:modelValue":e[7]||(e[7]=l=>a.guestIdNo=l),placeholder:"选填"},null,8,["modelValue"])]),_:1}),o(s,{label:"押金(元)",prop:"depositTotal"},{default:t(()=>[o(R,{modelValue:a.depositTotal,"onUpdate:modelValue":e[8]||(e[8]=l=>a.depositTotal=l),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(s,{label:"备注",prop:"remark"},{default:t(()=>[o(f,{modelValue:a.remark,"onUpdate:modelValue":e[9]||(e[9]=l=>a.remark=l),type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(O,{modelValue:c.value,"onUpdate:modelValue":e[14]||(e[14]=l=>c.value=l),title:"续住",width:"400px"},{footer:t(()=>[o(u,{onClick:e[13]||(e[13]=l=>c.value=!1)},{default:t(()=>[...e[22]||(e[22]=[m("取消",-1)])]),_:1}),o(u,{type:"primary",onClick:E},{default:t(()=>[...e[23]||(e[23]=[m("确定",-1)])]),_:1})]),default:t(()=>[o(U,{"label-width":"100px"},{default:t(()=>[o(s,{label:"房号"},{default:t(()=>{var l;return[m(h((l=V.value)==null?void 0:l.roomNo),1)]}),_:1}),o(s,{label:"新退房日期"},{default:t(()=>[o(D,{modelValue:y.value,"onUpdate:modelValue":e[12]||(e[12]=l=>y.value=l),type:"date","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},ie=H(ue,[["__scopeId","data-v-e7fcd0a7"]]);export{ie as default};
