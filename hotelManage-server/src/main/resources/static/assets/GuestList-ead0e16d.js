import{r as w}from"./request-7f0efd49.js";import{d as q}from"./dict-a540f38d.js";import{_ as M,B as j,r as s,o as N,c as L,b as a,w as n,e as _,f as C,E as v,H,a as h,i as m,F as O,C as z,D as J,n as K}from"./index-fddec7dd.js";function Q(p={}){return w({url:"/api/guest/list",method:"get",params:p})}function S(p){return w({url:"/api/guest/save",method:"post",data:p})}function W(p){return w({url:`/api/guest/${p}`,method:"delete"})}const X={class:"page"},Y={class:"toolbar"},Z={__name:"GuestList",setup(p){const V=_([]),u=_([]),f=C({name:"",phone:""}),y=_(!1),g=_(null),k=_(!1),o=C({id:null,name:"",phone:"",idTypeId:null,idTypeName:"",idNo:"",remark:""}),A={name:[{required:!0,message:"请输入姓名",trigger:"blur"}]};async function b(){var l;try{const e=await Q(f);console.log("Guest API Response:",e);const d=((l=e==null?void 0:e.data)==null?void 0:l.data)||(e==null?void 0:e.data)||e||[];console.log("Guest Data:",d),console.log("idTypeList:",u.value),V.value=d.map(r=>{var i;return{...r,idTypeName:Array.isArray(u.value)&&((i=u.value.find(T=>T.id===r.idTypeId))==null?void 0:i.name)||r.idTypeName}}),console.log("Processed guest list:",V.value)}catch(e){console.error("Load list error:",e),v.error("加载数据失败")}}async function G(){try{const l=await q();console.log("ID Type API Response:",l),u.value=Array.isArray(l==null?void 0:l.data)?l.data:Array.isArray(l)?l:[],console.log("Processed idTypeList:",u.value)}catch(l){console.error("Load dict error:",l),v.error("加载字典数据失败")}}function x(l){l?Object.assign(o,{id:l.id,name:l.name,phone:l.phone,idTypeId:l.idTypeId,idTypeName:l.idTypeName,idNo:l.idNo,remark:l.remark}):I(),y.value=!0}function I(){o.id=null,o.name="",o.phone="",o.idTypeId=null,o.idTypeName="",o.idNo="",o.remark="",H(()=>{var l,e;(l=g.value)==null||l.clearValidate(),(e=g.value)==null||e.resetFields()})}async function U(){var e;await((e=g.value)==null?void 0:e.validate().catch(()=>{}));const l=u.value.find(d=>d.id===o.idTypeId);k.value=!0;try{await S({...o,idTypeName:l==null?void 0:l.name}),v.success("保存成功"),y.value=!1,b()}catch(d){v.error((d==null?void 0:d.message)||"保存失败")}finally{k.value=!1}}async function B(l){await J.confirm("确定删除该客人档案吗？","提示",{type:"warning"}),await W(l.id),v.success("删除成功"),b()}return j(async()=>{await G(),await b()}),(l,e)=>{const d=s("el-button"),r=s("el-input"),i=s("el-table-column"),T=s("el-table"),D=s("el-card"),c=s("el-form-item"),E=s("el-option"),F=s("el-select"),$=s("el-form"),P=s("el-dialog");return N(),L("div",X,[a(D,null,{header:n(()=>[e[11]||(e[11]=h("span",null,"普通客人",-1)),a(d,{type:"primary",style:{float:"right"},onClick:e[0]||(e[0]=t=>x())},{default:n(()=>[...e[10]||(e[10]=[m("新增客人",-1)])]),_:1})]),default:n(()=>[h("div",Y,[a(r,{modelValue:f.name,"onUpdate:modelValue":e[1]||(e[1]=t=>f.name=t),placeholder:"姓名",clearable:"",style:{width:"140px"}},null,8,["modelValue"]),a(r,{modelValue:f.phone,"onUpdate:modelValue":e[2]||(e[2]=t=>f.phone=t),placeholder:"手机号",clearable:"",style:{width:"140px"}},null,8,["modelValue"]),a(d,{type:"primary",onClick:b},{default:n(()=>[...e[12]||(e[12]=[m("查询",-1)])]),_:1})]),a(T,{data:V.value,border:"",stripe:""},{default:n(()=>[a(i,{prop:"name",label:"姓名",width:"100"}),a(i,{prop:"phone",label:"手机号",width:"130"}),a(i,{prop:"idTypeName",label:"证件类型",width:"100"}),a(i,{prop:"idNo",label:"证件号",width:"180"}),a(i,{prop:"remark",label:"备注"}),a(i,{label:"操作",width:"140",fixed:"right"},{default:n(({row:t})=>[a(d,{link:"",type:"primary",onClick:R=>x(t)},{default:n(()=>[...e[13]||(e[13]=[m("编辑",-1)])]),_:1},8,["onClick"]),a(d,{link:"",type:"danger",onClick:R=>B(t)},{default:n(()=>[...e[14]||(e[14]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(P,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=t=>y.value=t),title:o.id?"编辑客人":"新增客人",width:"480px",onClose:I},{footer:n(()=>[a(d,{onClick:e[8]||(e[8]=t=>y.value=!1)},{default:n(()=>[...e[15]||(e[15]=[m("取消",-1)])]),_:1}),a(d,{type:"primary",loading:k.value,onClick:U},{default:n(()=>[...e[16]||(e[16]=[m("确定",-1)])]),_:1},8,["loading"])]),default:n(()=>[a($,{ref_key:"formRef",ref:g,model:o,rules:A,"label-width":"90px"},{default:n(()=>[a(c,{label:"姓名",prop:"name"},{default:n(()=>[a(r,{modelValue:o.name,"onUpdate:modelValue":e[3]||(e[3]=t=>o.name=t),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),a(c,{label:"手机号",prop:"phone"},{default:n(()=>[a(r,{modelValue:o.phone,"onUpdate:modelValue":e[4]||(e[4]=t=>o.phone=t),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),a(c,{label:"证件类型",prop:"idTypeId"},{default:n(()=>[a(F,{modelValue:o.idTypeId,"onUpdate:modelValue":e[5]||(e[5]=t=>o.idTypeId=t),placeholder:"请选择",style:{width:"100%"}},{default:n(()=>[(N(!0),L(O,null,z(u.value,t=>(N(),K(E,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"证件号",prop:"idNo"},{default:n(()=>[a(r,{modelValue:o.idNo,"onUpdate:modelValue":e[6]||(e[6]=t=>o.idNo=t),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),a(c,{label:"备注",prop:"remark"},{default:n(()=>[a(r,{modelValue:o.remark,"onUpdate:modelValue":e[7]||(e[7]=t=>o.remark=t),type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},te=M(Z,[["__scopeId","data-v-d89d44ae"]]);export{te as default};
